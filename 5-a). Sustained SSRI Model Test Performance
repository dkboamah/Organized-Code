
###############################################
# Sus SSRI

library(dplyr)
library(caret)
library(varSelRF)
library(pROC)
library(densratio)


setwd("/mnt/home/david_boamah/New_Data_Analysis/rda_Files/Feature_Selection/mRMR_SVM_RFE")
load("Sustained_SSRI_Boruta_varSelRF_Features.rda")


Sus_SSRI_mRMR_VarSel_Index_noReOrder

number_list <- c(1:length(Sus_SSRI_mRMR_VarSel_Index_noReOrder))
number_list <- as.list(number_list)
number_list

setwd("/mnt/home/david_boamah/Data_Analysis/rda_Files")
load("Batch1_Data.rda")

Sus_SSRI_top_1000_M_test <- testMatrix_Creation(matrix=Sus_SSRI_top_1000_M_training,testMatrix=Batch2_M_Matrix)

testMatrix_K <- Make_Matrix_K(matrix=Sus_SSRI_top_1000_M_training,testMatrix=Sus_SSRI_top_1000_M_test)
testMatrix_U <- Make_Matrix_U(matrix=Sus_SSRI_top_1000_M_training,testMatrix=Sus_SSRI_top_1000_M_test)

RF_test_list_NONE <- sapply(X=number_list,FUN=RF_Test_AUC,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Sus_SSRI_top_1000_M_training,exposure=SSRI_Sustained_Training,testMatrix=Sus_SSRI_top_1000_M_test,testExposure=Sus_Batch2_SSRI_Use)
RF_test_list_K_NONE <- sapply(X=number_list,FUN=RF_Test_AUC,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Sus_SSRI_top_1000_M_training,exposure=SSRI_Sustained_Training,testMatrix=testMatrix_K,testExposure=Sus_Batch2_SSRI_Use)
RF_test_list_U_NONE <- sapply(X=number_list,FUN=RF_Test_AUC,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Sus_SSRI_top_1000_M_training,exposure=SSRI_Sustained_Training,testMatrix=testMatrix_U,testExposure=Sus_Batch2_SSRI_Use)

max(RF_test_list_NONE)
max(RF_test_list_K_NONE) 
max(RF_test_list_U_NONE) 

#None: 0.7081395 - 957
#K: 0.8222384 - 838
#U: 0.8138081 - 569

which(unlist(RF_test_list_NONE)==max(unlist(RF_test_list_NONE))) 
which(unlist(RF_test_list_K_NONE)==max(unlist(RF_test_list_K_NONE))) 
which(unlist(RF_test_list_U_NONE)==max(unlist(RF_test_list_U_NONE))) 

RF_test_ROC_957_No_NONE <- RF_Test_ROC(x=43,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Sus_SSRI_Training_Boruta,exposure=SSRI_Sustained_Training,testMatrix=Sus_SSRI_Test_Boruta,testExposure=Sus_Batch2_SSRI_Use)
RF_test_ROC_838_K_NONE <- RF_Test_ROC(x=820,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Sus_SSRI_Training_Boruta,exposure=SSRI_Sustained_Training,testMatrix=testMatrix_K,testExposure=Sus_Batch2_SSRI_Use)
RF_test_ROC_430_U_NONE <- RF_Test_ROC(x=430,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Sus_SSRI_Training_Boruta,exposure=SSRI_Sustained_Training,testMatrix=testMatrix_U,testExposure=Sus_Batch2_SSRI_Use)

RF_test_pred_957_No_NONE <- RF_Test_pred(x=957,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Sus_SSRI_top_1000_M_training,exposure=SSRI_Sustained_Training,testMatrix=Sus_SSRI_top_1000_M_test,testExposure=Sus_Batch2_SSRI_Use)
RF_test_pred_838_K_NONE <- RF_Test_pred(x=838,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Sus_SSRI_top_1000_M_training,exposure=SSRI_Sustained_Training,testMatrix=testMatrix_K,testExposure=Sus_Batch2_SSRI_Use)
RF_test_pred_569_U_NONE <- RF_Test_pred(x=569,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Sus_SSRI_top_1000_M_training,exposure=SSRI_Sustained_Training,testMatrix=testMatrix_U,testExposure=Sus_Batch2_SSRI_Use)

RF_test_pred_957_No_NONE$class <- Sus_Batch2_SSRI_Use
RF_test_pred_838_K_NONE$class <- Sus_Batch2_SSRI_Use
RF_test_pred_569_U_NONE$class <- Sus_Batch2_SSRI_Use

setwd("/mnt/home/david_boamah/New_Data_Analysis/Tables")
write.csv(RF_test_pred_838_K_NONE, file = "Sus_SSRI_RF_test_838_pred_K_NONE.csv")
write.csv(RF_test_pred_957_No_NONE, file = "Sus_SSRI_RF_test_957_pred_No_NONE.csv")
write.csv(RF_test_pred_569_U_NONE, file = "Sus_SSRI_RF_test_569_pred_U_NONE.csv")


RF_sus_SSRI_pred_Sus_SSRI <- RF_Train_Best_Tune(x=1000,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Sus_SSRI_Batch1,exposure=Sus_Batch1_SSRI_Use,matrixSecond=Sus_SSRI_top_1000_M_training,exposureSecond=SSRI_Sustained_Training)
svmL_sus_SSRI_pred_Sus_SSRI <- svmL_Train_Best_Tune(x=1000,vector=Sus_SSRI_topFeatures_mRMR_SVMRFE,matrix=Sus_SSRI_Batch1,exposure=Sus_Batch1_SSRI_Use,matrixSecond=Sus_SSRI_top_1000_M_training,exposureSecond=SSRI_Sustained_Training)
svmR_sus_SSRI_pred_Sus_SSRI <- svmR_Train_Best_Tune(x=1000,vector=Sus_SSRI_topFeatures_mRMR_SVMRFE,matrix=Sus_SSRI_Batch1,exposure=Sus_Batch1_SSRI_Use,matrixSecond=Sus_SSRI_top_1000_M_training,exposureSecond=SSRI_Sustained_Training)

OG_RF_BestTune <- RF_Train_Best_Tune(x=1000,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Sus_SSRI_Batch1,exposure=Sus_Batch1_SSRI_Use)
OG_svmL_BestTune <- svmL_Train_best_tune(x=1000,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Sus_SSRI_Batch1,exposure=Sus_Batch1_SSRI_Use)
OG_svmR_BestTune <- svmR_Train_best_tune(x=1000,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Sus_SSRI_Batch1,exposure=Sus_Batch1_SSRI_Use)


Random_Test_RF_ROC_list <- list()
Random_Test_RF_auc_list <- list()

OG_RF_BestTune <- RF_Train_Best_Tune(x=957,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Sus_SSRI_top_1000_M_training,exposure=SSRI_Sustained_Training)

set.seed(123)
for(i in 1:1000){
	Random_Test_RF_ROC_list[i] <- list(Random_RF_Test_ROC(x=957,matrix=Batch1_M_Matrix,exposure=Sus_Batch1_SSRI_Use,matrixSecond=Batch2_M_Matrix,exposureSecond=Sus_Batch2_SSRI_Use))
}
#Mean AUROC: 0.5469 (Range: 0.3751–0.7304)

Random_Test_RF_auc_list <- sapply(X=Random_Test_RF_ROC_list,FUN=auc)

setwd("/mnt/home/david_boamah/NewGraphics")
pdf("Random_Sus_SSRI_Test_RF.pdf", 10, 10)
plot.roc(RF_test_ROC_957_No_NONE,lwd=1,main="Sustained SSRI Use: Test Performance – Random Forest Models")
set.seed(123)
replicate(1000,Plot_Random_RF_Test_ROC(x=957,matrix=Batch1_M_Matrix,exposure=Sus_Batch1_SSRI_Use,matrixSecond=Batch2_M_Matrix,exposureSecond=Sus_Batch2_SSRI_Use))
legend("bottomright", inset=.02, legend=c("Sustained SSRI; AUC: 0.708", "Permuted; Mean AUC: 0.547 "), col=c("black", "grey"), lty=c(1,1), lwd=c(1,0.5), cex=1.0)
dev.off()

RF_test_pred_957_Sus_SSRI_SusB2 <- RF_Test_pred(x=957,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Batch1_ace,exposure=Sus_Batch1_B2_Use,testMatrix=Batch2_ace,testExposure=Sus_Batch2_B2_Use)
RF_test_pred_957_Sus_SSRI_AnyB2 <- RF_Test_pred(x=957,vector=Sus_SSRI_mRMR_VarSel_Index_noReOrder,matrix=Batch1_ace,exposure=Any_Batch1_B2_Use,testMatrix=Batch2_ace,testExposure=Any_Batch2_B2_Use)

RF_test_pred_957_Sus_SSRI_SusB2$class <- Sus_Batch2_B2_Use
RF_test_pred_957_Sus_SSRI_AnyB2$class <- Any_Batch2_B2_Use 

setwd("/mnt/home/david_boamah/New_Data_Analysis/Tables")
write.csv(RF_test_pred_957_Sus_SSRI_SusB2, file = "RF_test_pred_957_Sus_SSRI_SusB2.csv")
write.csv(RF_test_pred_957_Sus_SSRI_AnyB2, file = "RF_test_pred_957_Sus_SSRI_AnyB2.csv")


Batch1_ace <- testMatrix_Creation(matrix=Sus_SSRI_top_1000_M_training,testMatrix=Batch1_M_Matrix)
Batch2_ace <- testMatrix_Creation(matrix=Sus_SSRI_top_1000_M_training,testMatrix=Batch2_M_Matrix)

svmL_test_pred_2_Sus_SSRI_SusB2 <- svmL_Test_pred(x=2,vector=Sus_SSRI_topFeatures_mRMR_SVMRFE,matrix=Batch1_ace,exposure=Sus_Batch1_B2_Use,testMatrix=Batch2_ace,testExposure=Sus_Batch2_B2_Use)
svmL_test_pred_2_Sus_SSRI_AnyB2 <- svmL_Test_pred(x=2,vector=Sus_SSRI_topFeatures_mRMR_SVMRFE,matrix=Batch1_ace,exposure=Any_Batch1_SSRI_Use,testMatrix=Batch2_ace,testExposure=Any_Batch2_B2_Use)

svmL_test_pred_2_Sus_SSRI_SusB2$class <- Sus_Batch2_B2_Use
svmL_test_pred_2_Sus_SSRI_AnyB2$class <- Any_Batch2_B2_Use 

setwd("/mnt/home/david_boamah/New_Data_Analysis/Tables")
write.csv(svmL_test_pred_2_Sus_SSRI_SusB2, file = "svmL_test_pred_2_Sus_SSRI_SusB2.csv")
write.csv(svmL_test_pred_2_Sus_SSRI_AnyB2, file = "svmL_test_pred_2_Sus_SSRI_AnyB2.csv")

svmR_test_pred_52_Sus_SSRI_SusB2 <- svmR_Test_pred(x=52,vector=Sus_SSRI_topFeatures_mRMR_SVMRFE,matrix=Batch1_ace,exposure=Sus_Batch1_B2_Use,testMatrix=Batch2_ace,testExposure=Sus_Batch2_B2_Use)
svmR_test_pred_52_Sus_SSRI_AnyB2 <- svmR_Test_pred(x=52,vector=Sus_SSRI_topFeatures_mRMR_SVMRFE,matrix=Batch1_ace,exposure=Any_Batch1_SSRI_Use,testMatrix=Batch2_ace,testExposure=Any_Batch2_B2_Use)

svmR_test_pred_52_Sus_SSRI_SusB2$class <- Sus_Batch2_B2_Use
svmR_test_pred_52_Sus_SSRI_AnyB2$class <- Any_Batch2_B2_Use 

setwd("/mnt/home/david_boamah/New_Data_Analysis/Tables")
write.csv(svmR_test_pred_52_Sus_SSRI_SusB2, file = "svmR_test_pred_52_Sus_SSRI_SusB2.csv")
write.csv(svmR_test_pred_52_Sus_SSRI_AnyB2, file = "svmR_test_pred_52_Sus_SSRI_AnyB2.csv")

Random_Test_svmL_ROC_list <- list()
Random_Test_svmL_auc_list <- list()

OG_svmL_BestTune <- svmL_Train_Best_Tune(x=2,vector=Sus_SSRI_topFeatures_mRMR_SVMRFE,matrix=Sus_SSRI_top_1000_M_training,exposure=SSRI_Sustained_Training)

set.seed(123)
for(i in 1:1000){
	Random_Test_svmL_ROC_list[i] <- list(Random_svmL_Test_ROC(x=2,matrix=Batch1_M_Matrix,exposure=Sus_Batch1_SSRI_Use,matrixSecond=Batch2_M_Matrix,exposureSecond=Sus_Batch2_SSRI_Use))
}
#Mean AUROC: 0.5666 (Range: 0.4009 –0.7570)

Random_Test_svmL_auc_list <- sapply(X=Random_Test_svmL_ROC_list,FUN=auc)

Random_Test_svmR_ROC_list <- list()
Random_Test_svmR_auc_list <- list()

OG_svmR_BestTune <- svmR_Train_Best_Tune(x=52,vector=Sus_SSRI_topFeatures_mRMR_SVMRFE,matrix=Sus_SSRI_top_1000_M_training,exposure=SSRI_Sustained_Training)

set.seed(123)
for(i in 1:1000){
	Random_Test_svmR_ROC_list[i] <- list(Random_svmR_Test_ROC(x=52,matrix=Batch1_M_Matrix,exposure=Sus_Batch1_SSRI_Use,matrixSecond=Batch2_M_Matrix,exposureSecond=Sus_Batch2_SSRI_Use))
}
#Mean AUROC: 0.5686 (Range: 0.4073 – 0.7858)

Random_Test_svmR_auc_list <- sapply(X=Random_Test_svmR_ROC_list,FUN=auc)


setwd("/mnt/home/david_boamah/NewGraphics")
pdf("Random_Sus_SSRI_Test_svmL.pdf", 10, 10)
plot.roc(svmL_test_ROC_2_No,lwd=1,main="Sustained SSRI Use: Test Performance – SVM-l Models")
set.seed(123)
replicate(1000,Plot_Random_svmL_Test_ROC(x=2,matrix=Batch1_M_Matrix,exposure=Sus_Batch1_SSRI_Use,matrixSecond=Batch2_M_Matrix,exposureSecond=Sus_Batch2_SSRI_Use))
legend("bottomright", inset=.02, legend=c("Sustained SSRI; AUC: 0.688", "Permuted; Mean AUC: 0.567"), col=c("black", "grey"), lty=c(1,1), lwd=c(1,0.5), cex=1.0)
dev.off()

pdf("Random_Sus_SSRI_Test_svmR.pdf", 10, 10)
plot.roc(svmR_test_ROC_52_No,lwd=1,main="Sustained SSRI Use: Test Performance – SVM-rbf Models")
set.seed(123)
replicate(1000,Plot_Random_svmR_Test_ROC(x=52,matrix=Batch1_M_Matrix,exposure=Sus_Batch1_SSRI_Use,matrixSecond=Batch2_M_Matrix,exposureSecond=Sus_Batch2_SSRI_Use))
legend("bottomright", inset=.02, legend=c("Sustained SSRI; AUC: 0.677", "Permuted; Mean AUC: 0.569 "), col=c("black", "grey"), lty=c(1,1), lwd=c(1,0.5), cex=1.0)
dev.off()




